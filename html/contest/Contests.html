<html>

<head>
    <title>Election Contests</title>
    <link rel="stylesheet" href="../css/stylesheet.css">
    <link rel="stylesheet" href="../../css/sidenav.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css"></script>
</head>

<body>
    <div class="sidenav">
        <a href="#">Home</a>
        <a href="../election/Events.html">Elections</a>
        <a href="../contest/Contests.html">Contests</a>
        <a href="../voter/Voters.html">Voters</a>
    </div>
    <div class="main">
        <div class="tableLayout" style="width: 75%;margin-left: auto;margin-right: auto;">
            <table id='outputTable' class="hover" style='margin:auto;width: 100%;'>
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>EVENT</th>
                        <th>JURISDICTION</th>
                        <th>OPTIONS</th>
                    </tr>
                </thead>
                <tbody id='tableBody'>
                </tbody>
            </table>
            <button onclick="window.location.href='ContestForm.html';">
                <span>Add New</span></button>
        </div>
    </div>

</body>

<!-- This script block has the Javas("#electionId").val()cript logic -->
<script type="text/javascript" language="javascript">
    //Document.ready waits for the page to finish loading then executes the code block
    $(document).ready(function () {
        $('#outputTable').dataTable({
            "info": false,
            "bLengthChange": false
        });
        //use the getJson function of jQuery to read from a REST API endpoint
        /* $.getJSON('http://localhost:3000/api/org.univote.Contest', function (contestData) {
            var electionName;
            console.log(contestData);
            for (var i = 0; i < contestData.length; i++) {
                $('#outputTable').dataTable().fnAddData([
                    contestData[i].contestName,
                    contestData[i].jurisdiction
                ]);
                await getElectionId(contestData[i].election.split("#").pop());
            };
        }); */

        $.ajax({
            url: 'http://localhost:3000/api/org.univote.Contest',
            dataType: 'json',
            async: 'true',
            success: function (contestData) {
                getElection(contestData);
            }
        });
        function getElection(contestData) {
            var tableData = {
                "contestName": "",
                "electionName": "",
                "jurisdiction": ""
            }
            for (var i = 0; i < contestData.length; i++) {
                (function (i) {
                    var request = $.ajax({
                        url: 'http://localhost:3000/api/org.univote.Election/' + contestData[i].election.split("#").pop(),
                        dataType: 'json',
                        async: 'true',
                        success: function (electionData) {
                            tableData.contestName = contestData[i].contestName;
                            tableData.jurisdiction = contestData[i].jurisdiction;
                            tableData.electionName = electionData.electionName;
                            populateTable(tableData);
                        }
                    });
                })(i);
            }
        }
        function populateTable(tableData) {
            $('#outputTable').dataTable().fnAddData([
                tableData.contestName,
                tableData.electionName,
                tableData.jurisdiction,
                "<button title='Edit' style='font-seize=1em'><i class='fas fa-edit'></i></button><button title='Delete' style='font-size:1em'><i class='fas fa-trash-alt'></i></button>"
            ]);
        }

    });

</script>

</html>